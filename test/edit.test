$ mkdir patches subdir

# Test the behavior if the editor modifies existing files
$ cat > editor
< #! /bin/sh
< echo Editing $1
< sed -e 's:foo:bar:' $1 > $1.new
< mv $1.new $1
$ chmod +x editor
$ export EDITOR=%{PWD}/editor

$ quilt new patch
> Patch patches/patch is now on top

$ echo foobar > foobar
$ quilt edit foobar
> File foobar added to patch patches/patch
> Editing foobar

$ cat foobar
> barbar

$ cd subdir
$ echo foo > foo
$ quilt edit foo
> File subdir/foo added to patch ../patches/patch
> Editing subdir/foo
$ cd ..

$ cat subdir/foo
> bar

$ quilt files
> foobar
> subdir/foo

$ quilt refresh
> Refreshed patch patches/patch

# Test the behavior if the editor is called on a new file but
# does not actually create it
$ cat > editor
< #! /bin/sh
< echo Doing nothing to $1

$ quilt edit nofoo
> File nofoo added to patch patches/patch
> Doing nothing to nofoo
> File nofoo removed from patch patches/patch

# Test the behavior if the editor creates a brand new file
$ cat > editor
< #! /bin/sh
< echo Creating $1
< echo "new line" > $1

$ quilt edit foo2
> File foo2 added to patch patches/patch
> Creating foo2
$ cat foo2
> new line

$ quilt files -v
> + foo2
>   foobar
>   subdir/foo
